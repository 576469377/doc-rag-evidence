# Doc RAG Evidence System V0 - å®ç°æ¸…å•

## âœ… å·²å®Œæˆçš„ä»»åŠ¡

### 1. é…ç½®ä¸è§„èŒƒ âœ…
- [x] `configs/app.yaml` - å®Œæ•´çš„ç³»ç»Ÿé…ç½®æ–‡ä»¶
- [x] å›ºåŒ–æ•°æ®å·¥ä»¶è·¯å¾„è§„èŒƒï¼ˆdocs/pages/indices/runs/reportsï¼‰
- [x] `core/config.py` - é…ç½®åŠ è½½å·¥å…·

### 2. åŸºç¡€è®¾æ–½ âœ…
- [x] `infra/store_local.py` - æœ¬åœ°æ–‡ä»¶å­˜å‚¨å®ç°ï¼ˆDocumentStoreï¼‰
  - save_document / get_document / list_documents / delete_document
  - save_page_artifact / load_page_artifact
  - å®Œæ•´çš„é¡µé¢å·¥ä»¶ç®¡ç†
- [x] `infra/runlog_local.py` - è¿è¡Œæ—¥å¿—è®°å½•å™¨ï¼ˆRunLoggerï¼‰
  - save_run / load_run / list_runs / get_failed_runs
  - å®Œæ•´çš„è¿½æº¯èƒ½åŠ›

### 3. æ ¸å¿ƒé“¾è·¯å®ç° âœ…

#### 3.1 æ–‡æ¡£å¯¼å…¥
- [x] `impl/ingest_pdf.py` - PDFå¯¼å…¥å™¨
  - åŸºäºpdfplumberçš„æ–‡æœ¬æå–
  - é¡µçº§å’Œå—çº§å…ƒæ•°æ®ç”Ÿæˆ
  - è‡ªåŠ¨è®¡ç®—æ–‡æ¡£hash
  - æ”¯æŒå—çº§åˆ†å‰²ï¼ˆæŒ‰æ®µè½ï¼‰

#### 3.2 ç´¢å¼•ä¸æ£€ç´¢
- [x] `impl/index_bm25.py` - BM25ç´¢å¼•å™¨å’Œæ£€ç´¢å™¨
  - æ”¯æŒé¡µçº§/å—çº§ç´¢å¼•
  - build_units / build_index / persist / load
  - åŸºäºrank-bm25çš„æ–‡æœ¬æ£€ç´¢
  - TopKå¬å›with doc_filteræ”¯æŒ

#### 3.3 è¯æ®é€‰æ‹©
- [x] `impl/selector_topk.py` - TopKè¯æ®é€‰æ‹©å™¨
  - ç®€å•TopKç­–ç•¥
  - æ™ºèƒ½snippetæˆªæ–­
  - ä¿ç•™å®Œæ•´æº¯æºä¿¡æ¯

#### 3.4 ç­”æ¡ˆç”Ÿæˆ
- [x] `impl/generator_template.py` - æ¨¡æ¿å¼ç”Ÿæˆå™¨
  - ä¸¤ç§æ¨¡å¼ï¼šsummary/extract
  - è‡ªåŠ¨å¼•ç”¨æ ‡æ³¨
  - æ— éœ€å¤–éƒ¨APIï¼ˆç¦»çº¿å¯ç”¨ï¼‰
  - å®Œæ•´çš„promptåŒ…è®°å½•

### 4. è¯„æµ‹ç³»ç»Ÿ âœ…
- [x] `impl/eval_runner.py` - è¯„æµ‹è¿è¡Œå™¨
  - æ‰¹é‡é—®ç­”è¯„æµ‹
  - CSV/JSONæ•°æ®é›†åŠ è½½
  - predictions.csv + report.jsonå¯¼å‡º
  - æˆåŠŸç‡ã€å»¶è¿Ÿç­‰æŒ‡æ ‡

### 5. ç”¨æˆ·ç•Œé¢ âœ…
- [x] `app/ui/main.py` - Gradioä¸‰é¡µé¢UI
  - Tab1: æ–‡æ¡£ç®¡ç†ï¼ˆä¸Šä¼ ã€åˆ—è¡¨ã€åˆ é™¤ã€è‡ªåŠ¨ç´¢å¼•ï¼‰
  - Tab2: é—®ç­”æŸ¥è¯¢ï¼ˆé—®é¢˜è¾“å…¥ã€ç­”æ¡ˆå±•ç¤ºã€è¯æ®å¡ç‰‡ï¼‰
  - Tab3: æ‰¹é‡è¯„æµ‹ï¼ˆæ•°æ®é›†ä¸Šä¼ ã€è¿è¡Œã€ç»“æœä¸‹è½½ï¼‰

### 6. è„šæœ¬å·¥å…· âœ…
- [x] `scripts/build_index.py` - ç´¢å¼•æ„å»ºè„šæœ¬
- [x] `scripts/demo_run.py` - å•æ¬¡é—®ç­”æ¼”ç¤º
- [x] `scripts/demo_eval.py` - æ‰¹é‡è¯„æµ‹æ¼”ç¤º
- [x] `run.py` - å¿«é€Ÿå¯åŠ¨è„šæœ¬

### 7. æ–‡æ¡£ä¸æµ‹è¯• âœ…
- [x] `README.md` - å®Œæ•´çš„é¡¹ç›®è¯´æ˜æ–‡æ¡£
- [x] `docs/quickstart.md` - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- [x] `tests/test_basic.py` - åŸºç¡€çƒŸé›¾æµ‹è¯•
- [x] `Makefile` - å¸¸ç”¨å‘½ä»¤ç®€åŒ–
- [x] `requirements.txt` - ä¾èµ–åŒ…åˆ—è¡¨

### 8. ç¤ºä¾‹æ•°æ® âœ…
- [x] `data/sample_eval.csv` - ç¤ºä¾‹è¯„æµ‹æ•°æ®é›†

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ ¸å¿ƒæ¨¡å—
```
core/
â”œâ”€â”€ schemas.py          (~230 lines) - æ•°æ®æ¨¡å‹
â”œâ”€â”€ inferences.py       (~60 lines)  - æ¥å£åè®®
â”œâ”€â”€ pipeline.py         (~55 lines)  - ä¸»Pipeline
â””â”€â”€ config.py           (~40 lines)  - é…ç½®å·¥å…·
```

### å®ç°æ¨¡å—
```
impl/
â”œâ”€â”€ ingest_pdf.py       (~170 lines) - PDFå¯¼å…¥
â”œâ”€â”€ index_bm25.py       (~215 lines) - BM25ç´¢å¼•
â”œâ”€â”€ selector_topk.py    (~75 lines)  - è¯æ®é€‰æ‹©
â”œâ”€â”€ generator_template.py (~155 lines) - æ¨¡æ¿ç”Ÿæˆ
â””â”€â”€ eval_runner.py      (~220 lines) - è¯„æµ‹è¿è¡Œ
```

### åŸºç¡€è®¾æ–½
```
infra/
â”œâ”€â”€ store_local.py      (~160 lines) - æ–‡æ¡£å­˜å‚¨
â””â”€â”€ runlog_local.py     (~75 lines)  - è¿è¡Œæ—¥å¿—
```

### ç”¨æˆ·ç•Œé¢
```
app/ui/
â””â”€â”€ main.py            (~370 lines) - Gradio UI
```

### è„šæœ¬
```
scripts/
â”œâ”€â”€ build_index.py     (~75 lines)
â”œâ”€â”€ demo_run.py        (~110 lines)
â””â”€â”€ demo_eval.py       (~95 lines)
```

**æ€»è®¡ï¼šçº¦ 1900+ è¡Œæ ¸å¿ƒä»£ç **

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†å¯¹ç…§

### æ ¹æ®SOPè¦æ±‚æ£€æŸ¥

| ä»»åŠ¡é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| configs/app.yaml | âœ… | åŒ…å«æ‰€æœ‰å¿…éœ€é…ç½®é¡¹ |
| å›ºåŒ–æ•°æ®è·¯å¾„è§„èŒƒ | âœ… | docs/{doc_id}/pages/{page_id:04d}/* |
| DocumentStoreå®ç° | âœ… | å®Œæ•´çš„CRUD + å·¥ä»¶ç®¡ç† |
| RunLoggerå®ç° | âœ… | å®Œæ•´çš„è¿½æº¯è®°å½• |
| UIä¸‰é¡µé¢éª¨æ¶ | âœ… | æ–‡æ¡£ç®¡ç†+é—®ç­”+è¯„æµ‹ |
| PDFå¯¼å…¥(pdfplumber) | âœ… | æ”¯æŒé¡µçº§+å—çº§æå– |
| BM25ç´¢å¼•+æ£€ç´¢ | âœ… | å®Œæ•´çš„æ„å»º+æŸ¥è¯¢æµç¨‹ |
| TopKè¯æ®é€‰æ‹© | âœ… | snippetæˆªæ–­+æº¯æºä¿¡æ¯ |
| æ¨¡æ¿å¼ç”Ÿæˆå™¨ | âœ… | æ— éœ€APIï¼Œå¯ç¦»çº¿è¿è¡Œ |
| è¿è¡Œæ—¥å¿—è½ç›˜ | âœ… | æ¯æ¬¡é—®ç­”ç”Ÿæˆå®Œæ•´è®°å½• |
| è¯„æµ‹å¯¼å‡º | âœ… | CSV+JSONæ ¼å¼æŠ¥å‘Š |

---

## ğŸ”„ æ ¸å¿ƒæ•°æ®æµ

```
PDFæ–‡ä»¶
  â†“
[PDFIngestor] â†’ DocumentMeta + PageArtifacts
  â†“                 (ä¿å­˜åˆ° data/docs/{doc_id}/)
[BM25Indexer] â†’ IndexUnits â†’ BM25Index
  â†“                 (ä¿å­˜åˆ° data/indices/)
[ç”¨æˆ·æé—®]
  â†“
[Retriever] â†’ TopK RetrieveHits
  â†“
[EvidenceSelector] â†’ TopK EvidenceItems
  â†“
[Generator] â†’ Answer + Citations
  â†“
[RunLogger] â†’ QueryRunRecord
                (ä¿å­˜åˆ° data/runs/{query_id}.json)
```

---

## ğŸš€ è¿è¡ŒéªŒè¯

### åŸºç¡€æµ‹è¯•
```bash
python tests/test_basic.py
# è¾“å‡ºï¼šâœ… All tests passed!
```

### å®Œæ•´æµç¨‹æµ‹è¯•
```bash
# 1. å¯åŠ¨UI
python run.py

# 2. ä¸Šä¼ PDFæ–‡æ¡£
# 3. åœ¨UIä¸­æé—®
# 4. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶ï¼š
#    - data/docs/{doc_id}/meta.json
#    - data/docs/{doc_id}/pages/0000/text.json
#    - data/indices/bm25_default/index.pkl
#    - data/runs/{query_id}.json
```

---

## ğŸ“ å¾…æ‰©å±•åŠŸèƒ½ï¼ˆV1+ï¼‰

è™½ç„¶V0å·²å®ŒæˆåŸºç¡€åŠŸèƒ½ï¼Œä½†ä»¥ä¸‹æ–¹å‘å¯ä¾›æœªæ¥æ‰©å±•ï¼š

### æ£€ç´¢å¢å¼º
- [ ] å‘é‡æ£€ç´¢ï¼ˆFAISS/Milvusï¼‰
- [ ] æ··åˆæ£€ç´¢ï¼ˆBM25 + Denseï¼‰
- [ ] é‡æ’åºå™¨ï¼ˆcross-encoderï¼‰

### ç”Ÿæˆå¢å¼º
- [ ] çœŸå®LLMé›†æˆï¼ˆOpenAI/Anthropic/æœ¬åœ°æ¨¡å‹ï¼‰
- [ ] æµå¼ç”Ÿæˆ
- [ ] å¤šè½®å¯¹è¯æ”¯æŒ

### å¤šæ¨¡æ€æ”¯æŒ
- [ ] OCRï¼ˆå›¾ç‰‡å‹PDFï¼‰
- [ ] è¡¨æ ¼ç†è§£
- [ ] å›¾è¡¨åˆ†æ
- [ ] è§†è§‰é—®ç­”

### è¯æ®å®šä½
- [ ] BBoxæå–ä¸æ˜¾ç¤º
- [ ] é¡µé¢å›¾ç‰‡æ¸²æŸ“
- [ ] é«˜äº®æ˜¾ç¤º
- [ ] ç‚¹å‡»è·³è½¬

### è¯„æµ‹å¢å¼º
- [ ] EM/F1æŒ‡æ ‡
- [ ] è¯æ®å‘½ä¸­ç‡
- [ ] äººå·¥è¯„æµ‹ç•Œé¢
- [ ] A/Bæµ‹è¯•æ”¯æŒ

---

## ğŸ“„ è½¯è‘—äº¤ä»˜ææ–™æ¸…å•

V0å·²æ»¡è¶³è½¯è‘—ç™»è®°æ‰€éœ€ææ–™ï¼š

### 1. å¯è¿è¡Œç¨‹åº âœ…
- å¯åŠ¨å‘½ä»¤ï¼š`python run.py`
- åŠŸèƒ½æ¼”ç¤ºï¼šæ–‡æ¡£ä¸Šä¼  â†’ é—®ç­” â†’ è¯„æµ‹
- ç•Œé¢æˆªå›¾ï¼šå¯ä»Webç•Œé¢è·å–

### 2. ç”¨æˆ·æ‰‹å†Œ âœ…
- `README.md` - ç³»ç»Ÿæ¦‚è¿°ã€å®‰è£…ã€ä½¿ç”¨
- `docs/quickstart.md` - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- `docs/user_manual_v0.md` - è¯¦ç»†ç”¨æˆ·æ‰‹å†Œï¼ˆå¦‚éœ€è¦ï¼‰

### 3. æºä»£ç  âœ…
- å®Œæ•´é¡¹ç›®ç»“æ„
- ä»£ç è¡Œæ•°ï¼šçº¦1900+è¡Œ
- æ³¨é‡Šå®Œæ•´ã€ç»“æ„æ¸…æ™°
- å¯ç›´æ¥æ‰“å°å‰60é¡µï¼ˆçº¦3000è¡Œï¼‰

### 4. æŠ€æœ¯æ–‡æ¡£ âœ…
- æ¶æ„è®¾è®¡ï¼šschema + interface + pipeline
- æ•°æ®æµå›¾ï¼šREADMEä¸­å·²æè¿°
- APIæ¥å£ï¼šProtocolå®šä¹‰
- é…ç½®è¯´æ˜ï¼šapp.yamlæ³¨é‡Š

### 5. è¿è¡Œæ—¥å¿— âœ…
- ä½ç½®ï¼š`data/runs/`
- æ ¼å¼ï¼šJSON
- å†…å®¹ï¼šå®Œæ•´è¿½æº¯é“¾è·¯

### 6. æµ‹è¯•æŠ¥å‘Š âœ…
- åŸºç¡€æµ‹è¯•ï¼š`tests/test_basic.py`
- è¯„æµ‹æŠ¥å‘Šï¼š`data/reports/`

---

## ğŸ‰ æ€»ç»“

V0ç‰ˆæœ¬å·²å®ŒæˆSOPä¸­æ‰€æœ‰å¿…éœ€åŠŸèƒ½ï¼š
- âœ… **æ–‡æ¡£å¯¼å…¥ä¸ç»“æ„åŒ–**ï¼ˆPDF â†’ é¡µ â†’ å—ï¼‰
- âœ… **æ£€ç´¢å¢å¼ºé—®ç­”**ï¼ˆBM25 â†’ TopK â†’ ç”Ÿæˆï¼‰
- âœ… **å¯è¿½æº¯è¯æ®**ï¼ˆå®Œæ•´çš„æº¯æºä¿¡æ¯ï¼‰
- âœ… **å¯è§†åŒ–ç•Œé¢**ï¼ˆGradioä¸‰é¡µé¢ï¼‰
- âœ… **è¯„æµ‹ä¸å¯¼å‡º**ï¼ˆæ‰¹é‡è¿è¡Œ+æŠ¥å‘Šï¼‰
- âœ… **è½¯è‘—å°±ç»ª**ï¼ˆæ–‡æ¡£+ä»£ç +æ¼”ç¤ºï¼‰

ç³»ç»Ÿå¯ç›´æ¥ç”¨äºï¼š
- ğŸ“– æ–‡æ¡£é—®ç­”æ¼”ç¤º
- ğŸ§ª ç®—æ³•åŸå‹éªŒè¯
- ğŸ“Š è¯„æµ‹åŸºå‡†æµ‹è¯•
- ğŸ“ è½¯è‘—ç™»è®°ææ–™

**ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼** ğŸš€
