# ğŸ“š Doc RAG Evidence System V0

å¤šæ¨¡æ€æ–‡æ¡£æ£€ç´¢å¢å¼ºé—®ç­”ä¸è¯æ®å®šä½ç³»ç»Ÿ - V0ç‰ˆæœ¬

## ğŸ¯ ç³»ç»Ÿç®€ä»‹

æœ¬ç³»ç»Ÿæä¾›å®Œæ•´çš„æ–‡æ¡£æ£€ç´¢å¢å¼ºé—®ç­”ï¼ˆRAGï¼‰èƒ½åŠ›ï¼Œæ”¯æŒï¼š
- âœ… PDFæ–‡æ¡£å¯¼å…¥ä¸ç»“æ„åŒ–å¤„ç†
- âœ… BM25æ–‡æœ¬æ£€ç´¢ï¼ˆå—çº§/é¡µçº§å¯é€‰ï¼‰
- âœ… é—®ç­”ç”Ÿæˆä¸è¯æ®è¿½æº¯
- âœ… å¯è§†åŒ–Webç•Œé¢ï¼ˆGradioï¼‰
- âœ… æ‰¹é‡è¯„æµ‹ä¸æŠ¥å‘Šå¯¼å‡º
- âœ… å®Œæ•´çš„è¿è¡Œæ—¥å¿—è®°å½•ï¼ˆè½¯è‘—å‹å¥½ï¼‰

### V0 ç‰¹æ€§

- **æ— éœ€å¤–éƒ¨API**ï¼šä½¿ç”¨æ¨¡æ¿å¼ç”Ÿæˆå™¨ï¼Œå¯ç¦»çº¿æ¼”ç¤º
- **å¯è¿½æº¯æ€§**ï¼šæ¯æ¬¡é—®ç­”éƒ½æœ‰å®Œæ•´çš„è¿è¡Œæ—¥å¿—ï¼ˆretrieval â†’ evidence â†’ generationï¼‰
- **çµæ´»é…ç½®**ï¼šYAMLé…ç½®æ–‡ä»¶ï¼Œæ”¯æŒpage/blockç²’åº¦åˆ‡æ¢
- **æ ‡å‡†åŒ–å­˜å‚¨**ï¼šè§„èŒƒçš„æ–‡ä»¶ç»“æ„ï¼Œä¾¿äºå®¡è®¡ä¸æ‰©å±•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

**ä¾èµ–åŒ…è¯´æ˜**ï¼š
- `pydantic>=2.0.0` - æ•°æ®éªŒè¯
- `pyyaml>=6.0` - é…ç½®æ–‡ä»¶è§£æ
- `pdfplumber>=0.10.0` - PDFæ–‡æœ¬æå–
- `rank-bm25>=0.2.2` - BM25æ£€ç´¢
- `gradio>=4.0.0` - Webç•Œé¢

### 2. å¯åŠ¨Webç•Œé¢

```bash
python run.py
# æˆ–ä½¿ç”¨ make
make run
```

ç•Œé¢å°†åœ¨ `http://127.0.0.1:7860` æ‰“å¼€ï¼ŒåŒ…å«ä¸‰ä¸ªæ ‡ç­¾é¡µï¼š
1. **æ–‡æ¡£ç®¡ç†**ï¼šä¸Šä¼ PDFã€æŸ¥çœ‹æ–‡æ¡£åˆ—è¡¨ã€åˆ é™¤æ–‡æ¡£
2. **é—®ç­”æŸ¥è¯¢**ï¼šè¾“å…¥é—®é¢˜ã€æŸ¥çœ‹ç­”æ¡ˆä¸è¯æ®
3. **æ‰¹é‡è¯„æµ‹**ï¼šä¸Šä¼ è¯„æµ‹æ•°æ®é›†ã€è¿è¡Œè¯„ä¼°ã€ä¸‹è½½ç»“æœ

### 3. å‘½ä»¤è¡Œä½¿ç”¨

#### æ„å»ºç´¢å¼•
```bash
python scripts/build_index.py
```

#### å•æ¬¡é—®ç­”
```bash
python scripts/demo_run.py "What is the main topic of the document?"
```

#### æ‰¹é‡è¯„æµ‹
```bash
python scripts/demo_eval.py data/sample_eval.csv
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
doc-rag-evidence/
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ app.yaml              # ç³»ç»Ÿé…ç½®ï¼ˆè·¯å¾„ã€ç²’åº¦ã€å‚æ•°ï¼‰
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ schemas.py            # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ inferences.py         # æ¥å£åè®®ï¼ˆProtocolï¼‰
â”‚   â””â”€â”€ pipeline.py           # æ ¸å¿ƒPipeline
â”œâ”€â”€ infra/
â”‚   â”œâ”€â”€ store_local.py        # æœ¬åœ°æ–‡ä»¶å­˜å‚¨
â”‚   â””â”€â”€ runlog_local.py       # è¿è¡Œæ—¥å¿—è®°å½•
â”œâ”€â”€ impl/
â”‚   â”œâ”€â”€ ingest_pdf.py         # PDFå¯¼å…¥å™¨ï¼ˆpdfplumberï¼‰
â”‚   â”œâ”€â”€ index_bm25.py         # BM25ç´¢å¼•+æ£€ç´¢
â”‚   â”œâ”€â”€ selector_topk.py      # TopKè¯æ®é€‰æ‹©
â”‚   â”œâ”€â”€ generator_template.py # æ¨¡æ¿å¼ç”Ÿæˆå™¨
â”‚   â””â”€â”€ eval_runner.py        # è¯„æµ‹è¿è¡Œå™¨
â”œâ”€â”€ app/
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ main.py           # Gradio UI
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ build_index.py        # æ„å»ºç´¢å¼•è„šæœ¬
â”‚   â”œâ”€â”€ demo_run.py           # å•æ¬¡é—®ç­”è„šæœ¬
â”‚   â””â”€â”€ demo_eval.py          # æ‰¹é‡è¯„æµ‹è„šæœ¬
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ docs/                 # æ–‡æ¡£å·¥ä»¶ç›®å½•
â”‚   â”œâ”€â”€ indices/              # ç´¢å¼•æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ runs/                 # è¿è¡Œæ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ reports/              # è¯„æµ‹æŠ¥å‘Šç›®å½•
â”‚   â””â”€â”€ sample_eval.csv       # ç¤ºä¾‹è¯„æµ‹æ•°æ®é›†
â””â”€â”€ run.py                    # å¿«é€Ÿå¯åŠ¨è„šæœ¬
```

---

## ğŸ”§ é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ï¼š[configs/app.yaml](configs/app.yaml)

å…³é”®é…ç½®é¡¹ï¼š
```yaml
# æ•°æ®ç›®å½•
data_root: "data"
docs_dir: "data/docs"
indices_dir: "data/indices"
runs_dir: "data/runs"
reports_dir: "data/reports"

# ç´¢å¼•ç²’åº¦ï¼ˆpage | blockï¼‰
chunk_level: "block"

# æ£€ç´¢å‚æ•°
top_k_retrieve: 20    # åˆå§‹å¬å›æ•°é‡
top_k_evidence: 5     # æœ€ç»ˆè¯æ®æ•°é‡

# å¼•ç”¨çº§åˆ«ï¼ˆpage | blockï¼‰
citation_level: "block"
```

---

## ğŸ“Š æ•°æ®å·¥ä»¶è·¯å¾„è§„èŒƒ

ç³»ç»Ÿéµå¾ªä»¥ä¸‹è·¯å¾„çº¦å®šï¼ˆè½¯è‘—å‹å¥½ï¼Œå¯è¿½æº¯ï¼‰ï¼š

```
data/
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ {doc_id}/
â”‚       â”œâ”€â”€ meta.json                         # æ–‡æ¡£å…ƒæ•°æ®
â”‚       â””â”€â”€ pages/
â”‚           â””â”€â”€ {page_id:04d}/
â”‚               â”œâ”€â”€ text.json                 # é¡µé¢æ–‡æœ¬
â”‚               â”œâ”€â”€ blocks.json               # å—åˆ—è¡¨
â”‚               â””â”€â”€ page.png                  # é¡µé¢å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ indices/
â”‚   â””â”€â”€ bm25_default/
â”‚       â””â”€â”€ index.pkl                         # BM25ç´¢å¼•
â”œâ”€â”€ runs/
â”‚   â””â”€â”€ {query_id}.json                       # å•æ¬¡é—®ç­”å®Œæ•´æ—¥å¿—
â””â”€â”€ reports/
    â””â”€â”€ {dataset}/
        â””â”€â”€ {timestamp}/
            â”œâ”€â”€ predictions.csv               # æ¯ä¸ªé—®é¢˜çš„ç»“æœ
            â””â”€â”€ report.json                   # æ±‡æ€»æŒ‡æ ‡
```

---

## ğŸ“ å…¸å‹ä½¿ç”¨æµç¨‹

### åœºæ™¯1ï¼šæ–‡æ¡£é—®ç­”ï¼ˆWebç•Œé¢ï¼‰

1. æ‰“å¼€Webç•Œé¢ï¼š`python run.py`
2. è¿›å…¥"æ–‡æ¡£ç®¡ç†"æ ‡ç­¾ï¼Œä¸Šä¼ PDFæ–‡ä»¶
3. ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼šæ–‡æ¡£å¯¼å…¥ â†’ æ–‡æœ¬æå– â†’ ç´¢å¼•æ„å»º
4. è¿›å…¥"é—®ç­”æŸ¥è¯¢"æ ‡ç­¾ï¼Œè¾“å…¥é—®é¢˜
5. æŸ¥çœ‹ç­”æ¡ˆã€è¯æ®åˆ—è¡¨ã€å¼•ç”¨ä¿¡æ¯

### åœºæ™¯2ï¼šæ‰¹é‡è¯„æµ‹ï¼ˆå‘½ä»¤è¡Œï¼‰

1. å‡†å¤‡è¯„æµ‹æ•°æ®é›†ï¼ˆCSVæˆ–JSONæ ¼å¼ï¼‰ï¼š
   ```csv
   qid,question,answer_gt
   q1,What is the main topic?,
   q2,What are the key findings?,
   ```

2. è¿è¡Œè¯„æµ‹ï¼š
   ```bash
   python scripts/demo_eval.py dataset.csv
   ```

3. æŸ¥çœ‹ç»“æœï¼š
   - æ§åˆ¶å°æ˜¾ç¤ºæˆåŠŸç‡ã€å¹³å‡å»¶è¿Ÿ
   - `data/reports/{dataset}/{timestamp}/predictions.csv` - è¯¦ç»†ç»“æœ
   - `data/reports/{dataset}/{timestamp}/report.json` - æ±‡æ€»æŒ‡æ ‡

### åœºæ™¯3ï¼šå•æ¬¡é—®ç­”è°ƒè¯•ï¼ˆå‘½ä»¤è¡Œï¼‰

```bash
python scripts/demo_run.py "What is the publication date?"
```

è¾“å‡ºåŒ…æ‹¬ï¼š
- ç­”æ¡ˆæ–‡æœ¬
- è¯æ®åˆ—è¡¨ï¼ˆdoc_idã€page_idã€scoreã€snippetï¼‰
- è¿è¡Œæ—¥å¿—è·¯å¾„ï¼ˆç”¨äºè¿½æº¯ï¼‰
- è®¡æ—¶ä¿¡æ¯ï¼ˆretrievalã€evidenceã€generationï¼‰

---

## ğŸ“ˆ æ‰©å±•æ–¹å‘

V0ç‰ˆæœ¬ä¸ºåç»­æ‰©å±•é¢„ç•™æ¥å£ï¼š

### å·²å®ç°ï¼ˆV0ï¼‰
- âœ… PDFæ–‡æœ¬æå–ï¼ˆpdfplumberï¼‰
- âœ… BM25æ£€ç´¢
- âœ… æ¨¡æ¿å¼ç”Ÿæˆï¼ˆæ— éœ€APIï¼‰
- âœ… è¿è¡Œæ—¥å¿—ä¸è¿½æº¯

### å¾…æ‰©å±•ï¼ˆV1+ï¼‰
- ğŸ”² å‘é‡æ£€ç´¢ï¼ˆFAISS/Milvusï¼‰
- ğŸ”² é‡æ’åºå™¨ï¼ˆcross-encoderï¼‰
- ğŸ”² çœŸå®LLMé›†æˆï¼ˆOpenAI/Anthropicï¼‰
- ğŸ”² OCRæ”¯æŒï¼ˆå›¾ç‰‡æ–‡æ¡£ï¼‰
- ğŸ”² BBoxå®šä½ä¸é«˜äº®
- ğŸ”² å¤šæ¨¡æ€æ¨¡å‹ï¼ˆè§†è§‰ç†è§£ï¼‰

---

## ğŸ›  æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šç´¢å¼•ä¸ºç©ºï¼Œæ— æ³•æ£€ç´¢
```bash
# é‡æ–°æ„å»ºç´¢å¼•
python scripts/build_index.py
```

### é—®é¢˜2ï¼šPDFå¯¼å…¥å¤±è´¥
- ç¡®è®¤ `pdfplumber` å·²å®‰è£…ï¼š`pip install pdfplumber`
- æ£€æŸ¥PDFæ–‡ä»¶æ˜¯å¦æŸå
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`data/runs/{query_id}.json`

### é—®é¢˜3ï¼šUIæ— æ³•å¯åŠ¨
- ç¡®è®¤ `gradio` å·²å®‰è£…ï¼š`pip install gradio`
- æ£€æŸ¥ç«¯å£7860æ˜¯å¦è¢«å ç”¨

---

## ğŸ“ è½¯è‘—äº¤ä»˜æ¸…å•

V0ç‰ˆæœ¬å·²æ»¡è¶³è½¯è‘—ç™»è®°è¦æ±‚ï¼š

- âœ… å¯è¿è¡Œç¨‹åºï¼ˆ`python run.py`ï¼‰
- âœ… ç”¨æˆ·æ‰‹å†Œï¼ˆæœ¬README + `docs/user_manual_v0.md`ï¼‰
- âœ… æºä»£ç ï¼ˆå®Œæ•´é¡¹ç›®ç»“æ„ï¼‰
- âœ… è¿è¡Œæ—¥å¿—ï¼ˆ`data/runs/` ç›®å½•ï¼‰
- âœ… ç•Œé¢æˆªå›¾ï¼ˆå¯ä»Webç•Œé¢è·å–ï¼‰
- âœ… è¯„æµ‹æŠ¥å‘Šï¼ˆ`data/reports/` ç›®å½•ï¼‰

---

## ğŸ“„ å¼€æºåè®®

MIT License

---

## ğŸ‘¥ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

å¼€å‘å»ºè®®ï¼š
1. éµå¾ªç°æœ‰ä»£ç é£æ ¼ï¼ˆç±»å‹æç¤ºã€æ–‡æ¡£å­—ç¬¦ä¸²ï¼‰
2. æ–°å¢æ¨¡å—è¯·å®ç°å¯¹åº”çš„Protocolæ¥å£
3. æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆå¯é€‰ï¼ŒV0æœªå¼ºåˆ¶è¦æ±‚ï¼‰
4. æ›´æ–°æœ¬READMEå’Œé…ç½®æ–‡æ¡£

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤GitHub Issueã€‚
